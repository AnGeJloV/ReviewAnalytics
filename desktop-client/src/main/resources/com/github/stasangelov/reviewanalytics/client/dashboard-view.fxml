<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.*?>
<?import javafx.scene.chart.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.SVGPath?>

<ScrollPane fitToWidth="true" style="-fx-background-color: transparent;" xmlns="http://javafx.com/javafx/17.0.12"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.github.stasangelov.reviewanalytics.client.controller.DashboardController">

    <VBox spacing="20.0" styleClass="content-background">
        <padding>
            <Insets bottom="20.0" left="20.0" right="20.0" top="20.0"/>
        </padding>

        <HBox alignment="BOTTOM_LEFT" spacing="10.0" styleClass="filter-bar">
            <VBox>
                <Label text="Период с:"/>
                <DatePicker fx:id="startDatePicker"/>
            </VBox>

            <VBox>
                <Label text="по:"/>
                <DatePicker fx:id="endDatePicker"/>
            </VBox>

            <VBox>
                <Label text="Категория:"/>
                <ComboBox fx:id="categoryComboBox" prefWidth="250.0" promptText="Все категории"/>
            </VBox>

            <VBox alignment="BOTTOM_LEFT">
                <HBox spacing="10.0">
                    <Button onAction="#applyFilters" styleClass="button-primary" text="Применить"/>
                    <Button onAction="#resetFilters" styleClass="button-secondary" text="Сбросить"/>
                </HBox>
            </VBox>
        </HBox>

        <GridPane hgap="20.0">
            <columnConstraints>
                <ColumnConstraints hgrow="SOMETIMES" percentWidth="50.0"/>
                <ColumnConstraints hgrow="SOMETIMES" percentWidth="50.0"/>
            </columnConstraints>

            <rowConstraints>
                <RowConstraints/>
            </rowConstraints>

            <HBox alignment="CENTER_LEFT" spacing="20.0" styleClass="kpi-card-new" GridPane.columnIndex="0">
                <StackPane styleClass="kpi-icon-container">
                    <SVGPath
                            content="M20,2H4C2.9,2 2,2.9 2,4V22L6,18H20C21.1,18 22,17.1 22,16V4C22,2.9 21.1,2 20,2Z"
                            styleClass="kpi-icon"/>
                </StackPane>

                <VBox>
                    <Label styleClass="kpi-title" text="Всего отзывов"/>
                    <Label fx:id="totalReviewsLabel" styleClass="kpi-value" text="-"/>
                </VBox>
            </HBox>

            <HBox alignment="CENTER_LEFT" spacing="20.0" styleClass="kpi-card-new" GridPane.columnIndex="1">
                <StackPane styleClass="kpi-icon-container">
                    <SVGPath
                            content="M12,17.27L18.18,21L17,14.64L22,9.73L15.36,8.82L12,2.5L8.64,8.82L2,9.73L7,14.64L5.82,21L12,17.27Z"
                            styleClass="kpi-icon"/>
                </StackPane>
                <VBox>
                    <Label styleClass="kpi-title" text="Средний интегральный рейтинг"/>
                    <Label fx:id="avgRatingLabel" styleClass="kpi-value" text="-"/>
                </VBox>
            </HBox>
        </GridPane>

        <GridPane hgap="20.0" VBox.vgrow="ALWAYS">
            <columnConstraints>
                <ColumnConstraints hgrow="SOMETIMES" percentWidth="50.0"/>
                <ColumnConstraints hgrow="SOMETIMES" percentWidth="50.0"/>
            </columnConstraints>

            <rowConstraints>
                <RowConstraints minHeight="10.0" vgrow="SOMETIMES"/>
            </rowConstraints>

            <VBox styleClass="chart-card">
                <Label styleClass="chart-title" text="Топ-5 лучших товаров"/>
                <BarChart fx:id="topProductsChart" animated="false" legendVisible="false"
                          VBox.vgrow="ALWAYS">
                    <xAxis>
                        <NumberAxis side="BOTTOM"/>
                    </xAxis>
                    <yAxis>
                        <CategoryAxis side="LEFT"/>
                    </yAxis>
                </BarChart>
            </VBox>

            <VBox styleClass="chart-card" GridPane.columnIndex="1">
                <Label styleClass="chart-title" text="Топ-5 худших товаров"/>
                <BarChart fx:id="worstProductsChart" animated="false" legendVisible="false"
                          VBox.vgrow="ALWAYS">
                    <xAxis>
                        <NumberAxis side="BOTTOM"/>
                    </xAxis>
                    <yAxis>
                        <CategoryAxis side="LEFT"/>
                    </yAxis>
                </BarChart>
            </VBox>
        </GridPane>

        <GridPane hgap="20.0" VBox.vgrow="ALWAYS">

            <columnConstraints>
                <ColumnConstraints hgrow="SOMETIMES" percentWidth="50.0"/>
                <ColumnConstraints hgrow="SOMETIMES" percentWidth="50.0"/>
            </columnConstraints>

            <rowConstraints>
                <RowConstraints minHeight="10.0" vgrow="SOMETIMES"/>
            </rowConstraints>

            <VBox styleClass="chart-card">
                <Label fx:id="categoryChartTitle" styleClass="chart-title"
                       text="Средний рейтинг по категориям"/>
                <BarChart fx:id="categoryChart" animated="false" legendVisible="false" VBox.vgrow="ALWAYS">
                    <xAxis>
                        <CategoryAxis side="BOTTOM"/>
                    </xAxis>
                    <yAxis>
                        <NumberAxis side="LEFT"/>
                    </yAxis>
                </BarChart>
            </VBox>

            <VBox styleClass="chart-card" GridPane.columnIndex="1">
                <Label styleClass="chart-title" text="Динамика среднего рейтинга"/>
                <LineChart fx:id="dynamicsChart" animated="false" legendVisible="false" VBox.vgrow="ALWAYS">
                    <xAxis>
                        <CategoryAxis label="Дата" side="BOTTOM"/>
                    </xAxis>
                    <yAxis>
                        <NumberAxis label="Средний рейтинг" side="LEFT"/>
                    </yAxis>
                </LineChart>
            </VBox>
        </GridPane>

        <VBox styleClass="chart-card">
            <Label styleClass="chart-title" text="Распределение оценок по критериям"/>

            <ScrollPane fx:id="distributionChartScrollPane" fitToHeight="true" fitToWidth="true"
                        VBox.vgrow="ALWAYS">
                <StackedBarChart fx:id="distributionChart" animated="false">
                    <xAxis>
                        <CategoryAxis label="Критерии" side="BOTTOM"/>
                    </xAxis>
                    <yAxis>
                        <NumberAxis label="Количество оценок" side="LEFT"/>
                    </yAxis>
                </StackedBarChart>
            </ScrollPane>
        </VBox>

        <VBox styleClass="chart-card" VBox.vgrow="ALWAYS">
            <HBox alignment="CENTER_LEFT" spacing="10" style="-fx-padding: 0 0 10 0;">
                <Label styleClass="chart-title" text="Сводка по товарам"/>
                <Region HBox.hgrow="ALWAYS"/>
                <TextField fx:id="productSearchField" prefWidth="300"
                           promptText="Поиск по названию, бренду..."/>
            </HBox>

            <TableView fx:id="productsSummaryTable" VBox.vgrow="ALWAYS">
                <columns>
                    <TableColumn fx:id="productNameCol" prefWidth="250.0" text="Название товара"/>
                    <TableColumn fx:id="categoryCol" prefWidth="150.0" text="Категория"/>
                    <TableColumn fx:id="brandCol" prefWidth="150.0" text="Бренд"/>
                    <TableColumn fx:id="reviewCountCol" prefWidth="120.0" text="Кол-во отзывов"/>
                    <TableColumn fx:id="avgRatingCol" prefWidth="150.0" text="Средний рейтинг"/>
                    <TableColumn fx:id="selectCol" prefWidth="70.0" text="Сравнить"/>
                </columns>
            </TableView>
        </VBox>
    </VBox>
</ScrollPane>
